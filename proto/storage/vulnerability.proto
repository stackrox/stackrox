syntax = "proto3";

option go_package = "storage";
option java_package = "io.stackrox.proto.storage";

import "google/protobuf/timestamp.proto";
import "storage/cve.proto";

import "gogoproto/gogo.proto";

package storage;

// TODO: Remove when migration is in place
// Next Tag: 16
message EmbeddedVulnerability {
    enum ScoreVersion {
        V2 = 0; // No unset for automatic backwards compatibility
        V3 = 1;
    }

    enum VulnerabilityType {
        UNKNOWN_VULNERABILITY = 0;
        IMAGE_VULNERABILITY   = 1;
        K8S_VULNERABILITY     = 2;
        ISTIO_VULNERABILITY   = 3;
        NODE_VULNERABILITY    = 4;
    }

    string                    cve                     = 1 [(gogoproto.moretags) = "search:\"CVE,store\""];
    float                     cvss                    = 2 [(gogoproto.moretags) = "search:\"CVSS,store\""];
    string                    summary                 = 3;
    string                    link                    = 4;
    oneof set_fixed_by {
        string                fixed_by                = 5 [(gogoproto.moretags) = "search:\"Fixed By,store,hidden\""];
    }
    ScoreVersion              score_version           = 8;
    CVSSV2                    cvss_v2                 = 6;
    CVSSV3                    cvss_v3                 = 7;
    google.protobuf.Timestamp published_on            = 9 [(gogoproto.moretags) = "search:\"CVE Published On,store\""];
    google.protobuf.Timestamp last_modified           = 10;
    VulnerabilityType         vulnerability_type      = 11;
    bool                      suppressed              = 12 [(gogoproto.moretags) = "search:\"CVE Snoozed,store\""];
    google.protobuf.Timestamp suppress_activation     = 13;
    google.protobuf.Timestamp suppress_expiry         = 14;
    // Time when the CVE was first seen in the system.
    google.protobuf.Timestamp first_system_occurrence = 15;
    // Time when the CVE was first seen in the image.
    google.protobuf.Timestamp first_image_occurrence  = 16;
}
