syntax = "proto3";

package storage;

import "google/protobuf/timestamp.proto";
import "storage/image.proto";

// TODO (ROX-30352): Review this whole proto for GA readiness.  Lots of copypasta.
message VirtualMachine {
  string id = 1; // @gotags: sql:"pk,type(uuid)"
  string namespace = 2; // @gotags: search:"Namespace,store"
  string name = 3;
  string cluster_id = 4; // @gotags: search:"Cluster ID,hidden,store"  sql:"type(uuid)"
  string cluster_name = 5;
  map<string, string> facts = 6;

  VirtualMachineScan scan = 7;

  google.protobuf.Timestamp last_updated = 8;

  enum Note {
    MISSING_METADATA = 0;
    MISSING_SCAN_DATA = 1;
    MISSING_SIGNATURE = 2;
    MISSING_SIGNATURE_VERIFICATION_DATA = 3;
  }
  repeated Note notes = 9;

  int32 vsock_cid = 10;
  enum State {
    UNKNOWN = 0;
    STOPPED = 1;
    RUNNING = 2;
  }
  State state = 11;
}

// TODO: Consider cleaning this up. It doesn't have to perfectly match the image scan message.
message VirtualMachineScan {
  string scanner_version = 1;
  google.protobuf.Timestamp scan_time = 2;
  // TODO (ROX-30352): We need to think hard about reusing EmbeddedImageScanComponent.  May need to use a new proto from scratch.
  repeated EmbeddedImageScanComponent components = 3;
  string operating_system = 4;
  // DataSource contains information about which integration was used to scan the image
  DataSource data_source = 5;
  enum Note {
    UNSET = 0;
    OS_UNAVAILABLE = 1;
    PARTIAL_SCAN_DATA = 2;
    OS_CVES_UNAVAILABLE = 3;
    OS_CVES_STALE = 4;
    LANGUAGE_CVES_UNAVAILABLE = 5;
    CERTIFIED_RHEL_SCAN_UNAVAILABLE = 6;
  }
  repeated Note notes = 6;
}
