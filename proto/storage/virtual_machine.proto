syntax = "proto3";

package storage;

import "google/protobuf/timestamp.proto";

// TODO (ROX-30352): Review this whole proto for GA readiness.  Lots of copypasta.
message VirtualMachine {
  string id = 1; // @gotags: sql:"pk,type(uuid)"
  string namespace = 2; // @gotags: search:"Namespace,store"
  string name = 3;
  string cluster_id = 4; // @gotags: search:"Cluster ID,hidden,store"  sql:"type(uuid)"
  string cluster_name = 5;
  map<string, string> facts = 6;

  VirtualMachineScan scan = 7;

  google.protobuf.Timestamp last_updated = 8;

  enum Note {
    MISSING_METADATA = 0;
    MISSING_SCAN_DATA = 1;
    MISSING_SIGNATURE = 2;
    MISSING_SIGNATURE_VERIFICATION_DATA = 3;
  }
  repeated Note notes = 9;

  int32 vsock_cid = 10;
  enum State {
    UNKNOWN = 0;
    STOPPED = 1;
    RUNNING = 2;
  }
  State state = 11;
}

// TODO: Consider cleaning this up. It doesn't have to perfectly match the image scan message.
message VirtualMachineScan {
  string scanner_version = 1;
  google.protobuf.Timestamp scan_time = 2;
  repeated EmbeddedVirtualMachineScanComponent components = 3;
}

// Next Tag: 14
message EmbeddedVirtualMachineScanComponent {
  string name = 1;
  string version = 2;
  repeated EmbeddedVirtualMachineVulnerability vulns = 4; // @gotags: hash:"set"
}

// Next Tag: 25
message EmbeddedVirtualMachineVulnerability {
  string cve = 1;
}
