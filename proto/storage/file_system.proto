syntax = "proto3";

package storage;

import "google/protobuf/timestamp.proto";
import "storage/process_indicator.proto";

option go_package = "./storage;storage";
option java_package = "io.stackrox.proto.storage";

message FileActivity {
  message File {
    string path = 1; // @gotags: search:"File Path"
    string host_path = 2; // @gotags: search:"File Host Path"
    bool is_external_mount = 3; // @gotags: search:"Externally Mounted"
  }

  enum Type {
    CREATION = 0;
    UNLINK = 1;
    RENAME = 2;
    PERMISSION_CHANGE = 3;
    OWNERSHIP_CHANGE = 4;
    WRITE = 5;
    OPEN = 6;
  }

  // No additional metadata required for create/unlink/write/open operations
  message FileCreation {}
  message FileUnlink {}
  message FileWrite {}
  message FileOpen {}

  message FileRename {
    File new = 1;
  }

  message FilePermissionChange {
    uint32 mode = 1;
  }

  message FileOwnershipChange {
    uint32 uid = 1;
    uint32 gid = 2;
    string username = 3;
    string group = 4;
  }

  google.protobuf.Timestamp timestamp = 1;
  ProcessIndicator process = 2;
  Type type = 3; // @gotags search:"File Activity"
  File file = 4;

  oneof activity {
    FileCreation creation = 5;
    FileUnlink unlink = 6;
    FileRename rename = 7;
    FilePermissionChange permission = 8;
    FileOwnershipChange ownership = 9;
    FileOpen open = 10;
    FileWrite write = 11;
  }
}
