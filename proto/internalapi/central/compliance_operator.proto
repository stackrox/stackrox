syntax = "proto3";

option go_package = "central";

package central;

// ComplianceOperatorInfo has basic info and status about the compliance operator.
message ComplianceOperatorInfo {
    string          version             = 1;
    string          namespace           = 2;

    // The following fields are made optional/nullable because there can be errors when trying to obtain them.
    oneof total_desired_pods_opt {
        int32       total_desired_pods  = 3;
    }
    oneof total_ready_pods_opt {
        int32       total_ready_pods    = 4;
    }

    // Collection of errors that occurred while trying to obtain collector health info.
    string          status_error        = 5;
}

message EnableComplianceRequest {
    string id = 1;
}

message DisableComplianceRequest {
    string id = 1;
}

// ApplyComplianceScanConfigRequest contains information about a compliance scan configuration to be applied to secured cluster.
message ApplyComplianceScanConfigRequest {
    message BaseScanSettings {
        string  db_record_id                = 1;
        string  scan_name                   = 2;

        bool    show_not_applicable         = 3;
        bool    strict_node_scan            = 4;
        bool    auto_apply_remediations     = 5;
        bool    auto_update_remediations    = 6;
    }

    message OneTimeScan {
        BaseScanSettings    scan_settings = 1;
        repeated string     profiles      = 2;
    }

    string          id            = 1;
    oneof scan_request {
        OneTimeScan one_time_scan = 2;
    }
}

// DeleteComplianceScanConfigRequest contains information about compliance scan configuration to be deleted from secured cluster.
message DeleteComplianceScanConfigRequest {
    string id       = 1;
    string name     = 2;
}

// ComplianceRequest is a message from Central (to Sensor) to perform an action related to compliance.
message ComplianceRequest {
    oneof request {
        EnableComplianceRequest             enable_compliance   = 1;
        DisableComplianceRequest            disable_compliance  = 2;
        ApplyComplianceScanConfigRequest    apply_scan_config   = 3;
        DeleteComplianceScanConfigRequest   delete_scan_config  = 4;
    }
}

// ComplianceResponse is a message from Sensor (to Central) representing success/failure processing request.
message ComplianceResponse {
    message EnableComplianceResponse {
        string      id      = 1;
        oneof payload {
            string  error   = 2;
        }
    }
    message DisableComplianceResponse {
        string      id      = 1;
        oneof payload {
            string  error   = 2;
        }
    }
    message ApplyComplianceScanConfigResponse {
        string      id      = 1;
        oneof payload {
            string  error   = 2;
        }
    }
    message DeleteComplianceScanConfigResponse {
        string      id      = 1;
        oneof payload {
            string  error   = 2;
        }
    }
    oneof response {
        EnableComplianceResponse            enable_compliance_response              = 1;
        DisableComplianceResponse           disable_compliance_response             = 2;
        ApplyComplianceScanConfigResponse   apply_compliance_scan_config_response   = 3;
        DeleteComplianceScanConfigResponse  delete_compliance_scan_config_response  = 4;
    }
}
