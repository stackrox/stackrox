package main

import (
	"strings"

	"github.com/stackrox/rox/generated/storage"
	"github.com/stackrox/rox/pkg/protocompat"
	"github.com/stackrox/rox/pkg/set"
)

var tableToProtoInterface = map[string]protocompat.Message{
	"active_components":                   (*storage.ActiveComponent)(nil),
	"administration_events":               (*storage.AdministrationEvent)(nil),
	"alerts":                              (*storage.Alert)(nil),
	"api_tokens":                          (*storage.TokenMetadata)(nil),
	"auth_machine_to_machine_configs":     (*storage.AuthMachineToMachineConfig)(nil),
	"auth_providers":                      (*storage.AuthProvider)(nil),
	"blobs":                               (*storage.Blob)(nil),
	"cloud_sources":                       (*storage.CloudSource)(nil),
	"cluster_cve_edges":                   (*storage.ClusterCVEEdge)(nil),
	"cluster_cves":                        (*storage.ClusterCVE)(nil),
	"cluster_health_statuses":             (*storage.ClusterHealthStatus)(nil),
	"cluster_init_bundles":                (*storage.InitBundleMeta)(nil),
	"clusters":                            (*storage.Cluster)(nil),
	"collections":                         (*storage.ResourceCollection)(nil),
	"compliance_configs":                  (*storage.ComplianceConfig)(nil),
	"compliance_domains":                  (*storage.ComplianceDomain)(nil),
	"compliance_integrations":             (*storage.ComplianceIntegration)(nil),
	"compliance_operator_check_result_v2": (*storage.ComplianceOperatorCheckResultV2)(nil),
	"compliance_operator_check_results":   (*storage.ComplianceOperatorCheckResult)(nil),
	"compliance_operator_cluster_scan_config_statuses": (*storage.ComplianceOperatorClusterScanConfigStatus)(nil),
	"compliance_operator_profile_v2":                   (*storage.ComplianceOperatorProfileV2)(nil),
	"compliance_operator_profiles":                     (*storage.ComplianceOperatorProfile)(nil),
	"compliance_operator_rule_v2":                      (*storage.ComplianceOperatorRuleV2)(nil),
	"compliance_operator_rules":                        (*storage.ComplianceOperatorRule)(nil),
	"compliance_operator_scan_configuration_v2":        (*storage.ComplianceOperatorScanConfigurationV2)(nil),
	"compliance_operator_scan_setting_binding_v2":      (*storage.ComplianceOperatorScanSettingBindingV2)(nil),
	"compliance_operator_scan_setting_bindings":        (*storage.ComplianceOperatorScanSettingBinding)(nil),
	"compliance_operator_scan_v2":                      (*storage.ComplianceOperatorScanV2)(nil),
	"compliance_operator_scans":                        (*storage.ComplianceOperatorScan)(nil),
	"compliance_operator_suite_v2":                     (*storage.ComplianceOperatorSuiteV2)(nil),
	"compliance_run_metadata":                          (*storage.ComplianceRunMetadata)(nil),
	"compliance_run_results":                           (*storage.ComplianceRunResults)(nil),
	"compliance_strings":                               (*storage.ComplianceStrings)(nil),
	"configs":                                          (*storage.Config)(nil),
	"declarative_config_healths":                       (*storage.DeclarativeConfigHealth)(nil),
	"delegated_registry_configs":                       (*storage.DelegatedRegistryConfig)(nil),
	"deployments":                                      (*storage.Deployment)(nil),
	"discovered_clusters":                              (*storage.DiscoveredCluster)(nil),
	"external_backups":                                 (*storage.ExternalBackup)(nil),
	"groups":                                           (*storage.Group)(nil),
	"hashes":                                           (*storage.Hash)(nil),
	"image_component_cve_edges":                        (*storage.ComponentCVEEdge)(nil),
	"image_component_edges":                            (*storage.ImageComponentEdge)(nil),
	"image_components":                                 (*storage.ImageComponent)(nil),
	"image_cve_edges":                                  (*storage.ImageCVEEdge)(nil),
	"image_cves":                                       (*storage.ImageCVE)(nil),
	"image_integrations":                               (*storage.ImageIntegration)(nil),
	"images":                                           (*storage.Image)(nil),
	"installation_infos":                               (*storage.InstallationInfo)(nil),
	"integration_healths":                              (*storage.IntegrationHealth)(nil),
	"k8s_roles":                                        (*storage.K8SRole)(nil),
	"listening_endpoints":                              (*storage.ProcessListeningOnPortStorage)(nil),
	"log_imbues":                                       (*storage.LogImbue)(nil),
	"namespaces":                                       (*storage.NamespaceMetadata)(nil),
	"network_baselines":                                (*storage.NetworkBaseline)(nil),
	"network_entities":                                 (*storage.NetworkEntity)(nil),
	"network_flows_v2":                                 (*storage.NetworkFlow)(nil),
	"network_graph_configs":                            (*storage.NetworkGraphConfig)(nil),
	"networkpolicies":                                  (*storage.NetworkPolicy)(nil),
	"networkpoliciesundodeployments":                   (*storage.NetworkPolicyApplicationUndoDeploymentRecord)(nil),
	"networkpolicyapplicationundorecords":              (*storage.NetworkPolicyApplicationUndoRecord)(nil),
	"node_component_edges":                             (*storage.NodeComponentEdge)(nil),
	"node_components":                                  (*storage.NodeComponent)(nil),
	"node_components_cves_edges":                       (*storage.NodeComponentCVEEdge)(nil),
	"node_cves":                                        (*storage.NodeCVE)(nil),
	"nodes":                                            (*storage.Node)(nil),
	"notification_schedules":                           (*storage.NotificationSchedule)(nil),
	"notifier_enc_configs":                             (*storage.NotifierEncConfig)(nil),
	"notifiers":                                        (*storage.Notifier)(nil),
	"permission_sets":                                  (*storage.PermissionSet)(nil),
	"pods":                                             (*storage.Pod)(nil),
	"policies":                                         (*storage.Policy)(nil),
	"policy_categories":                                (*storage.PolicyCategory)(nil),
	"policy_category_edges":                            (*storage.PolicyCategoryEdge)(nil),
	"process_baseline_results":                         (*storage.ProcessBaselineResults)(nil),
	"process_baselines":                                (*storage.ProcessBaseline)(nil),
	"process_indicators":                               (*storage.ProcessIndicator)(nil),
	"report_configurations":                            (*storage.ReportConfiguration)(nil),
	"report_snapshots":                                 (*storage.ReportSnapshot)(nil),
	"risks":                                            (*storage.Risk)(nil),
	"role_bindings":                                    (*storage.K8SRoleBinding)(nil),
	"roles":                                            (*storage.Role)(nil),
	"secrets":                                          (*storage.Secret)(nil),
	"secured_units":                                    (*storage.SecuredUnits)(nil),
	"sensor_upgrade_configs":                           (*storage.SensorUpgradeConfig)(nil),
	"service_accounts":                                 (*storage.ServiceAccount)(nil),
	"service_identities":                               (*storage.ServiceIdentity)(nil),
	"signature_integrations":                           (*storage.SignatureIntegration)(nil),
	"simple_access_scopes":                             (*storage.SimpleAccessScope)(nil),
	"system_infos":                                     (*storage.SystemInfo)(nil),
	"versions":                                         (*storage.Version)(nil),
	"vulnerability_requests":                           (*storage.VulnerabilityRequest)(nil),
	"watched_images":                                   (*storage.WatchedImage)(nil),
	"deployments_containers":                           (*storage.Container)(nil),
	"deployments_containers_envs":                      (*storage.ContainerConfig_EnvironmentConfig)(nil),
	"deployments_containers_secrets":                   (*storage.Secret)(nil),
	"deployments_containers_volumes":                   (*storage.Volume)(nil),
	"deployments_ports":                                (*storage.PortConfig)(nil),
	"deployments_ports_exposure_infos":                 (*storage.PortConfig_ExposureInfo)(nil),
	"images_layers":                                    (*storage.ImageLayer)(nil),
	"nodes_taints":                                     (*storage.Taint)(nil),
	"pods_live_instances":                              (*storage.Pod_ContainerInstanceList)(nil),
	"role_bindings_subjects":                           (*storage.K8SRoleBinding)(nil),
	"secrets_files":                                    (*storage.SecretDataFile)(nil),
	"secrets_files_registries":                         (*storage.ImagePullSecret_Registry)(nil),
}

var knownUnhandledBuckets = set.NewStringSet()

func getProtoInterface(tableName string) (protocompat.Message, bool) {
	msg, ok := tableToProtoInterface[tableName]
	if !ok && strings.HasPrefix(tableName, "network_flows_v2") {
		msg, ok = tableToProtoInterface["network_flows_v2"]
	}
	return msg, ok
}
