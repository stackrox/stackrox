name: Download Repo2CPE and Name2CPE
on:
  push:
    branches:
    - "yli3/**"
  schedule:
  - cron: "0 */3 * * *"

jobs:
  download:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Authenticate with Google Cloud
      uses: google-github-actions/auth@v1
      with:
        credentials_json: ${{ secrets.GOOGLE_SA_CIRCLECI_SCANNER }}

    - name: Set up Cloud SDK
      uses: google-github-actions/setup-gcloud@v1

    - name: Create Repo2CPE directory
      run: mkdir -p Repo2CPE

    - name: Download repository-to-cpe.json
      run: |
        cd Repo2CPE
        wget -q https://access.redhat.com/security/data/metrics/repository-to-cpe.json

    - name: Create Name2CPE directory
      run: mkdir -p Name2CPE

    - name: Download container-name-repos-map.json
      run: |
        cd Name2CPE
        wget -q https://access.redhat.com/security/data/metrics/container-name-repos-map.json

    - name: Check downloaded files
      run: |
        ls -l Repo2CPE/
        ls -l Name2CPE/

    - name: Upload files to Google Cloud Storage
      run: |
        gsutil cp -r "Repo2CPE" "gs://scanner-v4-test/"
        gsutil cp -r "Name2CPE" "gs://scanner-v4-test/"
