name: Update collector and scanner version
on:
  workflow_dispatch:
  push:
  schedule:
    - cron: 0 5 * * 1
jobs:
  update-versions:
    strategy:
      matrix:
       cmd:
        - cd deps/scanner && make tag | tee SCANNER_VERSION
        - cd deps/collector && make tag | tee COLLECTOR_VERSION
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Checkout scanner repo
      uses: actions/checkout@v3
      with:
        repository: stackrox/scanner
        path: deps/scanner
        fetch-depth: 0 # we need to fetch tags
    - name: Checkout collector repo
      uses: actions/checkout@v3
      with:
        repository: stackrox/collector
        path: deps/collector
        fetch-depth: 0 # we need to fetch tags
    - name: Update version
      run: '${{ matrix.cmd }}'
