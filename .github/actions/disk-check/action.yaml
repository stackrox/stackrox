name: disk check
description: check available disk space
runs:
  using: composite
  steps:
    - name: Check disk space
      shell: bash
      run: |
        set +e
        echo ">>> disk"
        df -h
        du -hs /* 2>/dev/null
        echo ">>> docker"
        docker system df
        echo ">>> golang"
        go env GOCACHE && du -hs "$(go env GOCACHE)"
        go env GOMODCACHE && du -hs "$(go env GOMODCACHE)"
        echo ">>> memory"
        free -m
        echo ">>> top memory processes"
        ps -e -o pid,vsz,comm= | sort -n -k 2 | tail -10

