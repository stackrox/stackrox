name: Job Preamble
description: Common steps for most jobs
inputs:
  gcp-account:
    description: 'Account to be used to upload tests data'
    required: true
runs:
  using: composite
  steps:
    - name: Recover docker image cache space
      run: |
        df --si /
        docker system prune --force --all
        df --si /
      shell: bash

    - name: Ignore dubious repository ownership
      run: |
        # Prevent fatal error "detected dubious ownership in repository" from recent git.
        git config --global --add safe.directory "$(pwd)"
      shell: bash

    - name: Record job
      env:
        GCP_SERVICE_ACCOUNT_STACKROX_CI: ${{ inputs.gcp-account }}
      run: |
        source scripts/ci/lib.sh
        setup_gcp
        create_job_record "${{ github.job }}"
      shell: bash
