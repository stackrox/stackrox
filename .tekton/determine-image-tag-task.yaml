apiVersion: tekton.dev/v1
kind: Task
metadata:
  name: determine-image-tag
  namespace: rh-acs-tenant
spec:
  description: Determining image tag with custom logic.
  params:
  results:
  - name: image-tag
    description: Image Tag determine by custom logic.
  steps:
  - name: determine-image-tag
    image: registry.access.redhat.com/ubi8:latest
    script: |
      #!/usr/bin/env bash
      set -euo pipefail
      dnf -y upgrade --nobest
      dnf -y install git make
      cd "$(workspaces.source.path)/source"
      echo -n "$(make --quiet --no-print-directory tag)-fast" | tee "$(results.image-tag.path)"
  workspaces:
    - name: source
      description: The workspace where source code is included.
