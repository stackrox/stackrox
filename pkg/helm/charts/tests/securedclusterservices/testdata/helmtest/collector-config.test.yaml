values:
  imagePullSecrets:
    allowNone: true
tests:
- name: "The collector config map should not exist when it is disabled"
  set:
    collector:
      runtimeConfig:
        enabled: "Enabled"
  expect: |
    .configmaps["collector-config"] | assertThat(. != null)
- name: "The collector config map should exist when it is enabled"
  set:
    collector:
      runtimeConfig:
        enabled: "Disabled"
  expect: |
    .configmaps["collector-config"] | assertThat(. == null)
- name: "The collector config should have the correct values for networking"
  set:
    collector:
      runtimeConfig:
        enabled: "Enabled"
        networking:
          externalIps:
            enabled: "Enabled"
          maxConnectionsPerMinute: 512
  expect: |
    .configmaps["collector-config"].data.["runtime_config.yaml"] | fromyaml | .networking.externalIps| assertThat(.enabled == "Enabled")
    .configmaps["collector-config"].data.["runtime_config.yaml"] | fromyaml | .networking.maxConnectionsPerMinute | assertThat(. == 512)
- name: "The collector config should have the correct values for networking 2"
  set:
    collector:
      runtimeConfig:
        enabled: "Enabled"
        networking:
          externalIps:
            enabled: "Disabled"
          maxConnectionsPerMinute: 200
  expect: |
    .configmaps["collector-config"].data.["runtime_config.yaml"] | fromyaml | .networking.externalIps.enabled | assertThat(. == "Disabled")
    .configmaps["collector-config"].data.["runtime_config.yaml"] | fromyaml | .networking.maxConnectionsPerMinute | assertThat(. == 200)
