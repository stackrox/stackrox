values:
  imagePullSecrets:
    allowNone: true
  monitoring:
    openshift:
      enabled: false
server:
  availableSchemas:
  - openshift-4.1.0
tests:
- name: "Webhook timeout pads AdmissionController timeout by 2 seconds"
  tests:
    - name: "default AdmissionController timeout is 10s + 2s padding"
      expect: |
        .validatingwebhookconfigurations[].webhooks[].timeoutSeconds | assertThat(. == 10 + 2)
    - name: "override sets value correctly"
      values:
        admissionControl:
          dynamic:
            timeout: 7
      expect: |
        .validatingwebhookconfigurations[].webhooks[].timeoutSeconds | assertThat(. == 7 + 2)
- name: "OpenShift3 clusters do not support admission control sideEffects"
  server:
    availableSchemas:
      - openshift-3.11.0
  set:
    env.openshift: 3
    admissionControl:
      listenOnEvents: true
      listenOnCreates: true
      listenOnUpdates: true
  expectError: true
- name: "scanInline defaults to false"
  set:
    admissionControl.dynamic.scanInline: null
  expect: |
    .secrets["helm-cluster-config"].stringData["config.yaml"] | fromyaml | .clusterConfig.dynamicConfig.admissionControllerConfig | assertThat(.scanInline == false)
