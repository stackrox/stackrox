{{- include "srox.init" . -}}

apiVersion: v1
kind: Secret
metadata:
  name: service-ca
  namespace: {{ ._rox._namespace }}
  labels:
    {{- include "srox.labels" (list . "secret" "service-ca") | nindent 4 }}
    auto-upgrade.stackrox.io/component: sensor
  annotations:
    {{- include "srox.annotations" (list . "secret" "service-ca") | nindent 4 }}
type: Opaque
stringData:
  ca.pem: |
    {{- if hasKey .Values.metadata.annotations "init-bundle.stackrox.io/name" }}
    {{- fail "It looks like you're using the incorrect init-bundle format. Make sure that you're using an init-bundle that was formatted for the Helm installation method and not Operator installation method." | indent 4 }}
    {{ end }}
    {{- required "A CA certificate must be specified" ._rox.ca._cert | nindent 4 }}
