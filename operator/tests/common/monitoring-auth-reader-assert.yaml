# Make kuttl ignore this file unless running against openshift.
apiVersion: kuttl.dev/v1beta1
kind: TestFile
testRunSelector:
  matchLabels:
    openshift: "true"
---
# We do this in a separate step because kuttl supports
# only one TestAssert object per step.
apiVersion: kuttl.dev/v1beta1
kind: TestAssert
commands:
# Test that Central auth reader rolebinding exists in kube-system.
- command: retry-kubectl.sh get rolebinding rhacs-central-auth-reader-${NAMESPACE} -n kube-system
resourceRefs:
- apiVersion: platform.stackrox.io/v1alpha1
  kind: Central
  name: stackrox-central-services
  ref: central_cr
assertAll:
- celExpr: "central_cr.status.conditions.filter(c, c.type=='Deployed').exists(c, c.status=='True')"
- celExpr: "central_cr.status.conditions.filter(c, c.type=='Initialized').exists(c, c.status=='True')"
- celExpr: "central_cr.status.conditions.filter(c, c.type=='Irreconcilable').exists(c, c.status=='False')"
- celExpr: "central_cr.status.conditions.filter(c, c.type=='ProxyConfigFailed').exists(c, c.status=='False')"
- celExpr: "central_cr.status.conditions.filter(c, c.type=='ReleaseFailed').exists(c, c.status=='False')"
- celExpr: "central_cr.status.conditions.filter(c, c.type=='Paused').exists(c, c.status=='False')"
- celExpr: "central_cr.status.conditions.filter(c, c.type=='Progressing').exists(c, c.status=='False')"
- celExpr: "central_cr.status.conditions.filter(c, c.type=='Available').exists(c, c.status=='True')"
