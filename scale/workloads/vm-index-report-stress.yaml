# VM Index Report Stress Test Workload
# This workload focuses on stress-testing the VM index report processing pipeline
# by generating a stream of VM index reports tied to the VM lifecycle.
#
# It includes a small background load from other system components to simulate
# a more realistic production environment.
#
# NOTE: Index reports are now unified with the VM informer workload.
# Reports are only sent while VMs are "alive" in the lifecycle simulation.

deploymentWorkload:
- deploymentType: Deployment
  lifecycleDuration: 1h
  numDeployments: 200
  numLifecycles: 0
  podWorkload:
    containerWorkload:
      numImages: 0
    lifecycleDuration: 2m
    numContainers: 3
    numPods: 5
    processWorkload:
      alertRate: 0.001
      processInterval: 30s
  updateInterval: 10m
networkWorkload:
  batchSize: 100
  flowInterval: 30s
  generateUnclosedEndpoints: true
  openPortReuseProbability: 0.05
nodeWorkload:
  numNodes: 100
rbacWorkload:
  numBindings: 100
  numRoles: 100
  numServiceAccounts: 100

# Unified VM workload: generates both informer events AND index reports
virtualMachineWorkload:
  # Number of VMs to simulate (pool size)
  # Each VM will have a unique ID and VSOCK CID
  poolSize: 10000

  # VM lifecycle settings
  # Long lifecycle ensures VMs stay alive and continuously send reports
  lifecycleDuration: 1h
  updateInterval: 5m
  numLifecycles: 0  # infinite
  initialReportDelay: 30s  # first report delayed with Â±20% jitter

  # Index report settings
  # Lower values = higher load (e.g., 100ms = 10 reports/second per VM)
  # With 10000 VMs at 60s interval, this generates ~167 reports/second total
  reportInterval: 60s

  # Number of packages to include in each IndexReport
  # Higher values = larger message size and more processing overhead
  numPackages: 1000

  # Number of repositories to include in each IndexReport
  # Higher values = larger message size and more processing overhead
  numRepositories: 500
