# Virtual Machine Workload Profile
# This workload generates fake VirtualMachine and VirtualMachineInstance CRD events
# to simulate KubeVirt workloads arriving through Kubernetes informers.
#
# The unified VirtualMachineWorkload config handles both:
# 1. VM/VMI informer events (always generated when poolSize > 0)
# 2. VM index reports (only generated when reportInterval > 0)
#
# Index reports are tied to VM lifecycle: reports are only sent while the VM is "alive".
# You can run just the informers (for testing k8s events) or informers + reports (full flow).
#
# Usage:
#   ROX_VIRTUAL_MACHINES=true go run tools/local-sensor/main.go -no-mem-prof -no-cpu-prof -with-metrics -with-fakeworkload scale/workloads/virtual-machines.yaml
#
# After running for some time and hitting Ctrl-C, check central-out.json for VM/VMI events.

nodeWorkload:
  numNodes: 50

numNamespaces: 20

rbacWorkload:
  numRoles: 100
  numServiceAccounts: 100
  numBindings: 100

# Unified VirtualMachine workload configuration
# Handles both informer events AND index reports in one config block
virtualMachineWorkload:
  # Pool size: number of VM/VMI templates to maintain (memory-efficient bounded pool)
  # This is the number of unique VMs that exist at any given time.
  poolSize: 50

  # How often to update VM/VMI metadata (annotations, labels, status)
  updateInterval: 30s

  # How long each VM/VMI lifecycle lasts before recreation
  lifecycleDuration: 10s

  # Number of times to recreate VMs/VMIs (0 = infinite)
  numLifecycles: 0

  # Optional: delay before the first index report for each VM (Â±20% jitter is always applied)
  initialReportDelay: 30s

  # === Index Report Settings (optional) ===
  # Set reportInterval > 0 to enable index report generation.
  # Reports are only sent while VMs are alive in the lifecycle.

  # How often each VM sends an index report (0 = no reports)
  reportInterval: 60s

  # Number of fake packages to include in each index report
  numPackages: 500

  # Number of fake repositories to include in each index report
  numRepositories: 50

# Optional: small background deployment workload
deploymentWorkload:
- deploymentType: Deployment
  numDeployments: 10
  numLabels: 5
  numLifecycles: 0
  lifecycleDuration: 30m
  updateInterval: 5m
  podWorkload:
    numContainers: 1
    numPods: 2
    lifecycleDuration: 10m
    containerWorkload:
      numImages: 0
    processWorkload:
      processInterval: 60s
      alertRate: 0.001

networkWorkload:
  flowInterval: 60s
  batchSize: 50
  generateUnclosedEndpoints: true
  openPortReuseProbability: 0.05
