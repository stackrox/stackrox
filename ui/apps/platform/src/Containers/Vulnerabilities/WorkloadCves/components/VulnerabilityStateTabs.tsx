import React from 'react';
import { Tabs, Tab, TabTitleText, TabsProps } from '@patternfly/react-core';

import { VulnerabilityState, isVulnerabilityState, vulnerabilityStates } from 'types/cve.proto';
import useFeatureFlags from 'hooks/useFeatureFlags';
import useURLStringUnion from 'hooks/useURLStringUnion';

export const vulnStateTabContentId = 'vulnerability-state-tab-content';

export type VulnerabilityStateTabsProps = {
    isBox?: TabsProps['isBox'];
    titleOverrides?: {
        observed?: string;
        deferred?: string;
        falsePositive?: string;
    };
    onChange?: (key: VulnerabilityState) => void;
};

function VulnerabilityStateTabs({
    titleOverrides,
    isBox = false,
    onChange,
}: VulnerabilityStateTabsProps) {
    const { isFeatureFlagEnabled } = useFeatureFlags();
    const isUnifiedDeferralsEnabled = isFeatureFlagEnabled('ROX_VULN_MGMT_UNIFIED_CVE_DEFERRAL');
    const [vulnerabilityStateKey, setVulnerabilityStateKey] = useURLStringUnion(
        'vulnerabilityState',
        vulnerabilityStates
    );

    return isUnifiedDeferralsEnabled ? (
        <Tabs
            activeKey={vulnerabilityStateKey}
            onSelect={(_e, tab) => {
                setVulnerabilityStateKey(tab);
                if (onChange && isVulnerabilityState(tab) && tab !== vulnerabilityStateKey) {
                    onChange(tab);
                }
            }}
            isBox={isBox}
        >
            <Tab
                eventKey="OBSERVED"
                title={<TabTitleText>{titleOverrides?.observed ?? 'Observed'}</TabTitleText>}
                tabContentId={vulnStateTabContentId}
            />
            <Tab
                eventKey="DEFERRED"
                title={<TabTitleText>{titleOverrides?.deferred ?? 'Deferred'}</TabTitleText>}
                tabContentId={vulnStateTabContentId}
            />
            <Tab
                eventKey="FALSE_POSITIVE"
                title={
                    <TabTitleText>
                        {titleOverrides?.falsePositive ?? 'False positives'}
                    </TabTitleText>
                }
                tabContentId={vulnStateTabContentId}
            />
        </Tabs>
    ) : null;
}

export default VulnerabilityStateTabs;
