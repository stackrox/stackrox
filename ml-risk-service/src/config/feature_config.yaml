# Feature configuration for ML risk ranking
features:
  deployment:
    policy_violations:
      enabled: true
      weight: 1.0
      normalize_saturation: 50
      max_value: 4.0

    process_baseline_violations:
      enabled: true
      weight: 0.8

    host_network:
      enabled: true
      weight: 0.7

    host_pid:
      enabled: true
      weight: 0.6

    host_ipc:
      enabled: true
      weight: 0.6

    privileged_containers:
      enabled: true
      weight: 0.9

    port_exposure:
      enabled: true
      weight: 0.5

    service_account_permissions:
      enabled: true
      weight: 0.6

    replicas:
      enabled: true
      weight: 0.3

  image:
    vulnerabilities:
      enabled: true
      weight: 1.0
      severity_weights:
        critical: 10.0
        high: 4.0
        medium: 1.0
        low: 0.25

    risky_components:
      enabled: true
      weight: 0.7

    component_count:
      enabled: true
      weight: 0.4

    image_age:
      enabled: true
      weight: 0.5
      age_threshold_days: 365

model:
  algorithm: "lightgbm_ranker"  # Options: lightgbm_ranker, sklearn_ranksvm
  validation_split: 0.2
  random_state: 42

  lightgbm_params:
    objective: "lambdarank"
    metric: "ndcg"
    num_leaves: 31
    learning_rate: 0.1
    feature_fraction: 0.9
    bagging_fraction: 0.8
    bagging_freq: 5
    verbose: 0

  explainability:
    shap_enabled: true
    top_features: 10

training:
  batch_size: 1000
  max_iterations: 100
  early_stopping_rounds: 10

api:
  grpc_port: 8080
  health_port: 8081
  max_workers: 10

# Central API configuration for training data collection
central_api:
  enabled: false  # Set to true to enable Central API integration
  endpoint: "https://central.stackrox.io"
  use_streaming_exports: true

  authentication:
    method: "api_token"  # Options: "api_token", "mtls"
    api_token: "${CENTRAL_API_TOKEN}"
    # For mTLS authentication:
    client_cert_path: "${CENTRAL_CLIENT_CERT_PATH}"
    client_key_path: "${CENTRAL_CLIENT_KEY_PATH}"
    ca_cert_path: "${CENTRAL_CA_CERT_PATH}"

  export_settings:
    # Simplified settings for workloads endpoint
    chunk_size: 1000
    timeout_seconds: 300
    max_workers: 2  # Only workloads + optional alerts/policies

    # Workload-specific settings
    workload_settings:
      include_vulnerabilities: true
      include_runtime_data: true
      min_cvss_score: 0.0
      vulnerability_states: ["ACTIVE", "OBSERVED"]

    # Default filters for training data collection
    filters:
      deployment_age_days: 90
      include_inactive: false
      severity_threshold: "MEDIUM_SEVERITY"
      include_alerts: true
      include_policies: false
      # clusters: ["prod-cluster-1", "staging-cluster"]
      # namespaces: ["default", "kube-system"]
      # vulnerability_states: ["ACTIVE", "OBSERVED"]

  retry:
    max_attempts: 3
    backoff_factor: 2
    resume_broken_streams: true

  # Performance tuning
  performance:
    batch_size: 100
    max_concurrent_streams: 2  # Simplified for workloads + alerts
    memory_limit_mb: 512  # Reduced due to simplified processing