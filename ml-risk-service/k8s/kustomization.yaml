apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: ml-risk-service

namespace: stackrox

resources:
- namespace.yaml
- configmap.yaml
- rbac.yaml
- pvc.yaml
- deployment.yaml
- service.yaml
- network-policy.yaml

images:
- name: stackrox/ml-risk-service
  newTag: latest

commonLabels:
  app.kubernetes.io/name: ml-risk-service
  app.kubernetes.io/component: ml-service
  app.kubernetes.io/part-of: stackrox

configMapGenerator:
- name: ml-risk-config
  files:
  - config/feature_config.yaml

patches:
# Patch to adjust resource requests/limits based on environment
- target:
    kind: Deployment
    name: ml-risk-service
  patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/memory
      value: 1Gi
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/memory
      value: 4Gi

# Patch to adjust replica count based on environment
- target:
    kind: Deployment
    name: ml-risk-service
  patch: |-
    - op: replace
      path: /spec/replicas
      value: 2