<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 700">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#0066cc"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="700" y="30" text-anchor="middle" font-size="24" font-weight="bold" fill="#2d2d2d">ML Training Pipeline</text>

  <!-- Step 1: Central API -->
  <rect x="50" y="80" width="200" height="150" fill="#ffe6e6" stroke="#dc3545" stroke-width="3" rx="10"/>
  <text x="150" y="110" text-anchor="middle" font-size="16" font-weight="bold" fill="#2d2d2d">StackRox Central</text>
  <text x="150" y="140" text-anchor="middle" font-size="14" fill="#333">Deployments</text>
  <text x="150" y="165" text-anchor="middle" font-size="14" fill="#333">Images</text>
  <text x="150" y="190" text-anchor="middle" font-size="14" fill="#333">Policy Violations</text>
  <text x="150" y="215" text-anchor="middle" font-size="14" fill="#333">Runtime Data</text>

  <!-- Arrow 1 -->
  <line x1="250" y1="155" x2="320" y2="155" stroke="#0066cc" stroke-width="3" marker-end="url(#arrow)"/>
  <text x="285" y="145" text-anchor="middle" font-size="12" fill="#0066cc">REST API</text>

  <!-- Step 2: Feature Extraction -->
  <rect x="330" y="80" width="220" height="150" fill="#e6f2ff" stroke="#0066cc" stroke-width="3" rx="10"/>
  <text x="440" y="110" text-anchor="middle" font-size="16" font-weight="bold" fill="#2d2d2d">Feature Extraction</text>
  <text x="440" y="140" text-anchor="middle" font-size="13" fill="#333">• Policy violations → score</text>
  <text x="440" y="165" text-anchor="middle" font-size="13" fill="#333">• CVEs → vuln features</text>
  <text x="440" y="190" text-anchor="middle" font-size="13" fill="#333">• Config → binary flags</text>
  <text x="440" y="215" text-anchor="middle" font-size="13" fill="#333">~20 numerical features</text>

  <!-- Arrow 2 -->
  <line x1="550" y1="155" x2="620" y2="155" stroke="#0066cc" stroke-width="3" marker-end="url(#arrow)"/>

  <!-- Step 3: Feature Matrix -->
  <rect x="630" y="80" width="200" height="150" fill="#f0e6ff" stroke="#6f42c1" stroke-width="3" rx="10"/>
  <text x="730" y="110" text-anchor="middle" font-size="16" font-weight="bold" fill="#2d2d2d">Feature Matrix</text>
  <text x="730" y="140" text-anchor="middle" font-size="13" fill="#333">X: [n_samples × 20]</text>
  <text x="730" y="165" text-anchor="middle" font-size="13" fill="#333">y: [risk scores]</text>
  <rect x="660" y="180" width="140" height="40" fill="none" stroke="#6f42c1" stroke-width="1" stroke-dasharray="5,5"/>
  <text x="730" y="205" text-anchor="middle" font-size="11" fill="#666">1000 deployments</text>

  <!-- Arrow 3 -->
  <line x1="830" y1="155" x2="900" y2="155" stroke="#0066cc" stroke-width="3" marker-end="url(#arrow)"/>

  <!-- Step 4: Data Split -->
  <rect x="910" y="60" width="180" height="80" fill="#d4edda" stroke="#28a745" stroke-width="2" rx="10"/>
  <text x="1000" y="85" text-anchor="middle" font-size="14" font-weight="bold" fill="#2d2d2d">Training (80%)</text>
  <text x="1000" y="110" text-anchor="middle" font-size="12" fill="#333">800 samples</text>
  <text x="1000" y="130" text-anchor="middle" font-size="12" fill="#28a745">Build model</text>

  <rect x="910" y="170" width="180" height="80" fill="#fff3cd" stroke="#ffc107" stroke-width="2" rx="10"/>
  <text x="1000" y="195" text-anchor="middle" font-size="14" font-weight="bold" fill="#2d2d2d">Validation (20%)</text>
  <text x="1000" y="220" text-anchor="middle" font-size="12" fill="#333">200 samples</text>
  <text x="1000" y="240" text-anchor="middle" font-size="12" fill="#ffc107">Test quality</text>

  <!-- Down arrow from split to preprocessing -->
  <line x1="1000" y1="255" x2="1000" y2="310" stroke="#0066cc" stroke-width="3" marker-end="url(#arrow)"/>

  <!-- Step 5: Preprocessing -->
  <rect x="850" y="320" width="300" height="100" fill="#e6f2ff" stroke="#0066cc" stroke-width="3" rx="10"/>
  <text x="1000" y="350" text-anchor="middle" font-size="16" font-weight="bold" fill="#2d2d2d">Preprocessing</text>
  <text x="1000" y="375" text-anchor="middle" font-size="13" fill="#333">StandardScaler (mean=0, std=1)</text>
  <text x="1000" y="400" text-anchor="middle" font-size="13" fill="#333">Handle zero-variance features</text>

  <!-- Down arrow to training -->
  <line x1="1000" y1="425" x2="1000" y2="480" stroke="#0066cc" stroke-width="3" marker-end="url(#arrow)"/>

  <!-- Step 6: RandomForest Training -->
  <rect x="850" y="490" width="300" height="140" fill="#d1f2eb" stroke="#28a745" stroke-width="3" rx="10"/>
  <text x="1000" y="520" text-anchor="middle" font-size="16" font-weight="bold" fill="#2d2d2d">RandomForest Training</text>
  <text x="1000" y="550" text-anchor="middle" font-size="13" fill="#333">n_estimators: 1000</text>
  <text x="1000" y="575" text-anchor="middle" font-size="13" fill="#333">max_depth: 25</text>
  <text x="1000" y="600" text-anchor="middle" font-size="13" fill="#333">Training time: ~30s</text>

  <!-- Arrow back to metrics -->
  <line x1="850" y1="560" x2="720" y2="560" stroke="#0066cc" stroke-width="3" marker-end="url(#arrow)"/>

  <!-- Step 7: Evaluation Metrics -->
  <rect x="480" y="490" width="230" height="140" fill="#fff3cd" stroke="#ffc107" stroke-width="3" rx="10"/>
  <text x="595" y="520" text-anchor="middle" font-size="16" font-weight="bold" fill="#2d2d2d">Performance Metrics</text>
  <text x="595" y="550" text-anchor="middle" font-size="14" fill="#28a745">Training NDCG: 0.97</text>
  <text x="595" y="575" text-anchor="middle" font-size="14" fill="#ffc107">Validation NDCG: 0.92</text>
  <text x="595" y="600" text-anchor="middle" font-size="13" fill="#333">Feature importance</text>

  <!-- Arrow down to storage -->
  <line x1="595" y1="490" x2="595" y2="350" stroke="#0066cc" stroke-width="3"/>
  <line x1="595" y1="350" x2="420" y2="350" stroke="#0066cc" stroke-width="3" marker-end="url(#arrow)"/>

  <!-- Step 8: Model Storage -->
  <rect x="220" y="300" width="190" height="100" fill="#d4edda" stroke="#28a745" stroke-width="3" rx="10"/>
  <text x="315" y="330" text-anchor="middle" font-size="16" font-weight="bold" fill="#2d2d2d">Model Storage</text>
  <text x="315" y="360" text-anchor="middle" font-size="13" fill="#333">/app/models/</text>
  <text x="315" y="385" text-anchor="middle" font-size="13" fill="#28a745">model.joblib + metadata</text>

  <!-- Legend -->
  <text x="50" y="680" font-size="14" fill="#666" font-weight="bold">Pipeline flow:</text>
  <text x="150" y="680" font-size="13" fill="#666">Raw data → Features → Train/Val split → Scale → Train → Evaluate → Store</text>
</svg>
